---
title: "completejourney"
author: "Team"
date: "2025-11-21"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Loading Packages
```{r}
suppressPackageStartupMessages({
  library(tidyverse)
  library(ggplot2)
  library(here)
  library(completejourney)
  
  # we have not seen much of these packages in class so I included a summary
  library(lubridate) #standardizes and converts dates into usable data
  library(janitor) #easier cleaner for duplicates, NA(s), and inconsistencies
})
```

# Taking a look at the "Complete Journey" dataset
```{r}
# Note: use the glimpse function with:
# "transactions_sample" to see spending/purchasing info
# "products" to see product info
# "demographics" to see household info

transactions <- transactions_sample
products <- products
demographics <- demographics
glimpse(transactions)
glimpse(products)
glimpse(demographics)
```

# Editing/Sorting data
```{r}
# checking for NA percentage
na_percent <- function(df) {
  sapply(df, function(x) mean(is.na(x)) * 100)
}

na_percent(transactions)
na_percent(products)
na_percent(demographics)

# removing NA values in package_category, package_type + removing package_size, home_ownership, marital_status

products_clean <- products |> filter( # removes NA(s)
  !is.na(product_category),
  !is.na(product_type)
  ) |> select( # keeps only listed columns
    product_id,
    manufacturer_id,
    department,
    brand,
    product_category,
    product_type
  )

demographics_clean <- demographics |> select(
  household_id,
  age,
  income,
  household_size,
  household_comp,
  kids_count
)

# check NA values again
na_percent(transactions)
na_percent(products_clean)
na_percent(demographics_clean)


# now merge transactions with the products data and the demographics dataset

customer_data <- transactions |> left_join(products_clean, by = "product_id") |> left_join(demographics_clean, by = "household_id")

na_percent(customer_data)

# removing rows with missing demographic and product info
customer_data <- customer_data |> filter(
  !is.na(age),
  !is.na(income),
  !is.na(household_size)
)

customer_data <- customer_data |> filter(
  !is.na(product_category),
  !is.na(product_type),
  !is.na(manufacturer_id)
)

na_percent(customer_data)


# creating time features: year, month, week, day of week + seasons: winter, spring, summer, fall

customer_data <- customer_data |> mutate(
  transaction_timestamp = ymd_hms(transaction_timestamp),
  year = year(transaction_timestamp),
  month = month(transaction_timestamp),
  week = week(transaction_timestamp),
  day_of_week = wday(transaction_timestamp, label = TRUE),

  seasons = case_when(
    month %in% c(12, 1, 2) ~ "Winter",
    month %in% c(3, 4, 5) ~ "Spring",
    month %in% c(6, 7, 8) ~ "Summer",
    month %in% c(9, 10, 11) ~ "Fall"
  )
) |> select(-transaction_timestamp)

#reordering the dataset
customer_data <- customer_data %>%
  select(
    household_id,
    store_id,
    basket_id,
    product_id,
    quantity,
    sales_value,
    retail_disc,
    coupon_disc,
    coupon_match_disc,
    year,
    month,
    week,
    day_of_week,
    seasons,
    manufacturer_id,
    department,
    brand,
    product_category,
    product_type,
    age,
    income,
    household_size,
    household_comp,
    kids_count
  )

#NOTE: I am uploading the markdown to GitHub in increments so the one you have will have less than what I have.

```
